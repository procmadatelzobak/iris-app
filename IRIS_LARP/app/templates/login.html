{% extends "base.html" %}

{% block content %}

<body class="bg-black text-green-500 font-mono h-screen flex items-center justify-center relative overflow-hidden">
    <div class="crt-overlay"></div>
    <div class="scan-line"></div>

    <div class="z-10 bg-gray-900 border border-green-800 p-8 shadow-2xl w-96 relative">
        <h1 class="text-3xl font-bold mb-6 text-center glitch-effect tracking-widest text-green-400">IRIS_SECURITY</h1>

        <form action="/auth/login" method="post" class="space-y-6">
            <div>
                <label class="block text-xs mb-1 text-green-700">IDENTIFIKÁTOR</label>
                <input type="text" name="username"
                    class="w-full bg-black border border-green-700 p-2 text-green-400 focus:outline-none focus:border-green-400"
                    required autofocus autocomplete="off">
            </div>

            <div>
                <label class="block text-xs mb-1 text-green-700">HESLO</label>
                <input type="password" name="password"
                    class="w-full bg-black border border-green-700 p-2 text-green-400 focus:outline-none focus:border-green-400"
                    required>
            </div>

            <button type="submit"
                class="w-full bg-green-900 text-green-100 p-3 hover:bg-green-700 border border-green-600 transition duration-150 uppercase tracking-widest font-bold">
                [ INICIOVAT RELACI ]
            </button>
        </form>

        <div class="mt-4 text-center text-xs text-green-900">
            NEOPRÁVNĚNÝ PŘÍSTUP JE TRESTNÝ<br>
            PROTOKOL V.3.1.2
        </div>
    </div>
</body>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const errorMsg = document.getElementById('errorMsg');

        try {
            const response = await fetch('/auth/login', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (response.ok) {
                localStorage.setItem('token', data.access_token);
                // Set cookie for HTML navigation
                document.cookie = `access_token=${data.access_token}; path=/; max-age=86400`;

                // Redirect based on role
                // We can just go to /auth/terminal. The backend will serve the right template.
                window.location.href = '/auth/terminal';
            } else {
                errorMsg.textContent = data.detail || 'Access Denied';
                errorMsg.classList.remove('hidden');
            }
        } catch (err) {
            errorMsg.textContent = 'Connection Error';
            errorMsg.classList.remove('hidden');
        }
    });
</script>
{% endblock %}