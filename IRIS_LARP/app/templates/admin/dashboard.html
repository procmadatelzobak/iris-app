padding: 1rem 2rem;
color: #880;
border-right: 1px solid #330;
cursor: pointer;
font-weight: bold;
}

.nav-btn:hover {
background: #220;
color: #ff0;
}

.nav-btn.active {
background: #330;
color: #ff0;
border-bottom: 3px solid #f00;
}

.view-container {
padding: 1rem;
height: calc(100vh - 60px);
overflow-y: auto;
}

/* Monitor Grid */
.monitor-grid {
display: grid;
grid-template-columns: repeat(4, 1fr);
gap: 1rem;
}

.session-card {
background: rgba(0, 10, 0, 0.9);
border: 1px solid #330000;
padding: 10px;
height: 250px;
/* Fixed height for consistency */
display: flex;
flex-direction: column;
}

/* Controls Layout */
.canvas-container {
border: 1px solid #330;
height: 100px;
width: 100%;
position: relative;
}

/* Economy Table */
.eco-table {
width: 100%;
border-collapse: collapse;
}

.eco-table th,
.eco-table td {
border: 1px solid #330;
padding: 0.5rem;
text-align: left;
}

.eco-table th {
color: #f00;
}

.btn-action {
border: 1px solid #555;
padding: 2px 8px;
color: #aaa;
cursor: pointer;
}

.btn-action:hover {
border-color: #fff;
color: #fff;
}
</style>
{% endblock %}

{% block content %}
<div class="crt-overlay"></div>
<div class="flex flex-col h-screen">

    <div class="admin-nav z-10">
        <div class="nav-btn active" onclick="switchView('monitor')" id="nav-monitor">MONITOR</div>
        <div class="nav-btn" onclick="switchView('controls')" id="nav-controls">CONTROLS</div>
        <div class="nav-btn" onclick="switchView('economy')" id="nav-economy">ECONOMY</div>
        <div class="nav-btn" onclick="switchView('tasks')" id="nav-tasks">TASKS</div>

        <div class="ml-auto flex gap-4">
            <div class="nav-btn text-yellow-500" onclick="toggleEditMode()">[ âœŽ LABELS ]</div>
            <div class="nav-btn text-red-500" onclick="toggleAIModal()">[ AI CONFIG ]</div>
            <div class="nav-btn text-red-500" onclick="triggerReset()">[ RESET ]</div>
        </div>
    </div>

    <!-- View A: MONITOR -->
    <div id="view-monitor" class="view-container">
        <h2 class="text-xl text-green-600 mb-4 font-bold border-b border-green-900 pb-2">LIVE FEED // SHIFT: <span
                id="monitorShift">0</span></h2>
        <div class="monitor-grid" id="sessionGrid">
            <!-- Generated by JS -->
        </div>
    </div>

    <!-- View B: CONTROLS -->
    <div id="view-controls" class="view-container hidden">
        <div class="grid grid-cols-2 gap-8">
            <!-- Global Shift -->
            <div class="border border-yellow-900 p-6 bg-black">
                <h3 class="text-2xl text-yellow-500 mb-6 editable-label" data-key="lbl_shift">GLOBAL SHIFT</h3>
                <div class="text-6xl font-bold text-white mb-6" id="controlShift">0</div>
                <button class="w-full border border-yellow-500 text-yellow-500 py-4 hover:bg-yellow-900 editable-label"
                    data-key="btn_shift" onclick="triggerShift()">
                    [ >> EXECUTE SHIFT >> ]
                </button>
            </div>

            <!-- Power & Instability Column -->
            <div class="space-y-6">
                <!-- Power Management v1.4 -->
                <div class="border border-blue-900 p-6 bg-black">
                    <h3 class="text-2xl text-blue-500 mb-4 editable-label" data-key="lbl_energy">CORE REACTOR OUTPUT
                    </h3>
                    <div class="bg-gray-900 border border-blue-900 p-2 mb-4 rounded relative overflow-hidden h-8">
                        <div id="powerBar" class="h-full bg-blue-600 transition-all duration-500 relative"
                            style="width: 10%;">
                            <!-- Stripe Pattern -->
                            <div class="absolute inset-0"
                                style="background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.3) 10px, rgba(0,0,0,0.3) 20px);">
                            </div>
                        </div>
                        <div
                            class="absolute inset-0 flex items-center justify-center text-white text-shadow font-bold z-10">
                            <span id="powerText">-- / -- MW</span>
                        </div>
                    </div>
                    <button
                        class="w-full border border-blue-500 text-blue-500 py-2 hover:bg-blue-900 transition editable-label"
                        data-key="btn_buy_power" onclick="buyPower()">
                        [ BUY POWER (+50MW) - 1000 CR ]
                    </button>
                </div>

                <!-- Instability -->
                <div class="border border-red-900 p-6 bg-black">
                    <h3 class="text-2xl text-red-500 mb-6 editable-label" data-key="lbl_chernobyl">CHERNOBYL INSTABILITY
                    </h3>
                    <div class="bg-gray-900 border border-red-900 p-2 mb-4 rounded relative overflow-hidden h-8">
                        <!-- Background Grid -->
                        <div class="absolute inset-0 opacity-20"
                            style="background-image: linear-gradient(90deg, transparent 50%, #300 50%); background-size: 20px 100%;">
                        </div>

                        <!-- The Bar -->
                        <div id="chemBar" class="h-full transition-all duration-1000 ease-out relative"
                            style="width: 0%; background: linear-gradient(90deg, #00ff00, #ffff00, #ff0000);">
                            <div class="absolute right-0 top-0 bottom-0 w-2 bg-white opacity-50 animate-pulse"></div>
                        </div>

                        <!-- Overlay Text -->
                        <div
                            class="absolute inset-0 flex items-center justify-center font-bold text-shadow text-white z-10">
                            <span id="controlChernobyl">0%</span>
                        </div>
                    </div>

                    <div class="mb-6">
                        <span class="text-gray-500 block mb-2">AGENCY OPERATION MODE</span>
                        <div class="flex gap-2">
                            <button class="flex-1 border border-gray-600 p-2 text-gray-400 hover:text-white transition"
                                onclick="setMode('normal')">NORMAL</button>
                            <button class="flex-1 border border-gray-600 p-2 text-gray-400 hover:text-white transition"
                                onclick="setMode('low_power')">LOW POWER</button>
                            <button class="flex-1 border border-red-600 p-2 text-red-500 hover:bg-red-900 transition"
                                onclick="setMode('overclock')">OVERCLOCK</button>
                        </div>
                    </div>

                    <div class="mb-6 border-t border-gray-800 pt-4">
                        <span class="text-gray-500 block mb-2">VISIBILITY PROTOCOLS</span>
                        <div class="flex gap-2">
                            <!-- Renamed IDs/Keys for consistent Labeling if needed, but existing logic serves -->
                            <button
                                class="flex-1 border border-blue-600 p-2 text-blue-400 hover:text-white transition width-auto"
                                onclick="setHyperVis('normal')">NORMAL</button>
                            <button
                                class="flex-1 border border-gray-600 p-2 text-gray-400 hover:bg-gray-900 transition width-auto"
                                onclick="setHyperVis('blackbox')">BLACKBOX</button>
                            <button
                                class="flex-1 border border-purple-600 p-2 text-purple-400 hover:bg-purple-900 transition width-auto"
                                onclick="setHyperVis('forensic')">FORENSIC</button>
                        </div>
                    </div>

                    <input type="range" class="w-full accent-red-600" min="0" max="100" id="manualChernobyl"
                        onchange="sendChernobylLevel(this.value)">
                    <div class="text-xs text-gray-600 mt-1">MANUAL OVERRIDE</div>
                </div>
            </div>
        </div>
    </div>

    <!-- View C: ECONOMY -->
    <div id="view-economy" class="view-container hidden">
        <div
            class="border border-yellow-900 p-4 mb-6 bg-black flex justify-between items-center shadow-lg shadow-yellow-900/20">
            <div>
                <h3 class="text-yellow-500 font-bold tracking-widest text-sm mb-1">SYSTEM TREASURY</h3>
                <div class="text-4xl text-white font-mono" id="treasuryBalance">---- CR</div>
            </div>
            <div class="text-right font-mono text-sm">
                <div class="text-gray-400">TAX RATE: <span class="text-white">10%</span></div>
                <div class="text-gray-400">STATUS: <span class="text-green-500">ACTIVE</span></div>
            </div>
        </div>

        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl text-yellow-600 font-bold">SUBJECT ECONOMY</h2>
            <button class="btn-action border-yellow-500 text-yellow-500" onclick="refreshEconomy()">REFRESH
                DATA</button>
        </div>
        <table class="eco-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>USER</th>
                    <th>CREDITS</th>
                    <th>STATUS</th>
                    <th>LOCK</th>
                    <th>ACTIONS</th>
                </tr>
            </thead>
            <tbody id="economyTableBody">
                <!-- JS -->
            </tbody>
        </table>
    </div>

    <!-- View D: TASKS -->
    <div id="view-tasks" class="view-container hidden">
        <div class="grid grid-cols-2 gap-4 h-full">
            <div class="border border-blue-900 p-4 flex flex-col">
                <h3 class="text-blue-500 font-bold mb-2">PENDING APPROVAL</h3>
                <div class="flex-1 overflow-y-auto space-y-2" id="pendingTasksCtx"></div>
            </div>
            <div class="border border-green-900 p-4 flex flex-col">
                <h3 class="text-green-500 font-bold mb-2">SUBMITTED FOR PAYMENT</h3>
                <div class="flex-1 overflow-y-auto space-y-2" id="submittedTasksCtx"></div>
            </div>
        </div>
    </div>

    <!-- AI Config Modal (Reused) -->
    <div id="aiModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex items-center justify-center">
        <!-- (Same as before, I'll allow JS to handle loading/saving logic, just keeping structure) -->
        <div class="bg-gray-900 border border-green-500 w-3/4 h-3/4 p-4 flex flex-col shadow-lg">
            <div class="flex justify-between items-center mb-4 pb-2 border-b border-gray-700">
                <h2 class="text-xl text-green-500 font-bold">SYSTEM CONFIGURATION // AI NODE</h2>
                <button class="text-red-500 hover:text-white" onclick="toggleAIModal()">[ CLOSE ]</button>
            </div>
            <div class="flex gap-4 mb-4">
                <button class="btn-admin flex-1" onclick="switchConfigTab('keys')">API KEYS</button>
                <button class="btn-admin flex-1" onclick="switchConfigTab('hyper')">HYPER</button>
            </div>
            <div class="flex-1 overflow-y-auto p-2 border border-gray-800 bg-black">
                <!-- Brief placeholders, JS loads content -->
                <div id="conf-keys" class="conf-tab">
                    <p class="text-gray-500">API KEYS CONFIG (See Admin UI JS)</p>
                    <!-- I should preserve the inputs for JS to find -->
                    <div class="space-y-4">
                        <div class="flex items-center gap-4">
                            <label class="w-24 text-gray-400">OPENROUTER</label>
                            <input type="password" id="key-openrouter" class="flex-1 bg-gray-800 text-white p-2">
                            <button class="btn-action" onclick="saveKey('openrouter')">SAVE</button>
                            <span id="status-openrouter" class="text-xs">...</span>
                        </div>
                    </div>
                </div>
                <div id="conf-hyper" class="conf-tab hidden">
                    <label>MODEL</label>
                    <input type="text" id="hyper-model" class="w-full bg-gray-800 text-white p-2 mb-2">
                    <label>PROMPT</label>
                    <textarea id="hyper-prompt" class="w-full bg-gray-800 text-pink-300 p-2 h-64"></textarea>
                    <button class="w-full btn-action mt-2" onclick="saveConfig('hyper')">UPDATE</button>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/socket_client.js"></script>
<script src="/static/js/admin_ui.js"></script>
{% endblock %}